<head>
<script type="text/javascript" src="https://www.airconsole.com/api/airconsole-1.6.0.js"></script>
  <link rel="stylesheet" href="controller.css">
  <link rel="stylesheet" href="shared.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
</head>
	
<body>

<div class="choice_1" id="choice_1"></div>
<div class="choice_2" id="choice_2"></div>
<div class="choice_3" id="choice_3"></div>
<div class="choice_4" id="choice_4"></div>

<div class="choice_3" id="choice_5"></div>
<div class="choice_4" id="choice_6"></div>
<div class="choice_1" id="choice_7"></div>
<div class="choice_2" id="choice_8"></div>

<div class="choice_2" id="choice_9"></div>
<div class="choice_1" id="choice_10"></div>
<div class="choice_4" id="choice_11"></div>
<div class="choice_3" id="choice_12"></div>

<div class="choice_4" id="choice_13"></div>
<div class="choice_3" id="choice_14"></div>
<div class="choice_D" id="choice_D">Debug</div>
<div class="choice_N" id="choice_N">Next Song</div>

<script type="text/javascript">
    var air_console = new AirConsole();
	
	// tracks whether or not the player has one or more letters on the artist
	var on_artist_track = 0;
	var artist_track_word = '';
	// tracks whether or not the player has one or more letters on the title
	var on_title_track = 0;
	var title_track_word = '';
	
	// array of all reasonable characters
	var alphabet = [ 'A','B','C','D','E','F','G','H','I','J','K','L','M','N','O','P','Q','R','S','T','U','V','W','X','Y','Z','1','2','3','4','5','6','7','8','9','0' ];
	
	
	
	// mix random characters onto the grid
	function mix_characters( solution , type_of_track ){
		// remove previous click handlers or we will end up crashing the browser(s)
		$(".correctArtist").off('click');
		$(".correctTitle").off('click');
			
		remove_correct_classes();
		
		// reset both solutions
		title_solution = 0;
		artist_solution = 0;
	
		if ( typeof type_of_track === 'undefined' ){
			// determine where to put each correct letter
			title_solution = Math.floor(Math.random() * 15 ) + 1;
			artist_solution = Math.floor(Math.random() * 15 ) + 1;
			// make sure the two solutions have different spaces
			while( artist_solution === title_solution ){
				artist_solution = Math.floor(Math.random() * 15 ) + 1;
			}
		} else {
			// check to see which path we are on to make sure we mix in the correct next character
			if( type_of_track === 'title' ){
				title_solution = Math.floor(Math.random() * 15 ) + 1;
			} else if ( type_of_track === 'artist' ){
				artist_solution = Math.floor(Math.random() * 15 ) + 1;
			}
		}
		for( var counter = 1; counter < 15; counter++ ){
			if( counter === title_solution ){
				$("#choice_" + counter).html(solution.title[on_title_track]);
				$("#choice_" + counter).addClass("correctTitle");
			} else if ( counter === artist_solution ){
				$("#choice_" + counter).html(solution.artist[on_artist_track]);
				$("#choice_" + counter).addClass("correctArtist");
			} else {
				// do it randomly
				letterIndex = Math.floor(Math.random() * alphabet.length );
				$("#choice_" + counter).html(alphabet[letterIndex]);
				// if the added letter is also correct, also add the class
				if( alphabet[letterIndex] === solution.title[on_title_track]){
					$("#choice_" + counter).addClass("correctTitle");
				}
				if( alphabet[letterIndex] === solution.artist[on_artist_track]){
					$("#choice_" + counter).addClass("correctArtist");
				}
			}
		}
		
		// handle clicking on a correct characters - this is done after generating the letters
		$(".correctTitle").click(function(){
			on_title_track++;
			title_track_word = title_track_word + $(this).html();
			// let the screen know somebody got a character right
			var correctGuess = [];
			correctGuess.push({ type: "correctGuess", type_of_guess: 'title' ,  progress: on_title_track, word: title_track_word });
			air_console.message( 0 , correctGuess );
			
			// prepare next characters
			mix_characters( solution , 'title' );
		});
		$(".correctArtist").click(function(){
			on_artist_track++;
			artist_track_word = artist_track_word + $(this).html();
			// let the screen know somebody got a character right
			var correctGuess = [];
			correctGuess.push({ type: "correctGuess", type_of_guess: 'artist' ,  progress: on_artist_track, word: artist_track_word });
			air_console.message( 0 , correctGuess );

			// prepare next characters
			mix_characters( solution , 'artist' );
		});
	}
	
	function remove_correct_classes(){
		$(".correctArtist").removeClass("correctArtist");
		$(".correctTitle").removeClass("correctTitle");
	}
	


	$("#choice_N").click(function( event ){
		// play next song
		var command = [];
		command.push({ type: "nextSong" });
		air_console.message( 0 , command );
	});
	
	$("#choice_D").click(function( event ){
		// turn debug on/off
		var command = [];
		command.push({ type: "debug" });
		air_console.message( 0 , command );
	});
	
	// Listen for messages from other devices
    air_console.onMessage = function(from, data) {
		// analyze data
		if ( data[0].type === "solution" ){
			console.log('received solution');
			// reset progress
			var on_artist_track = 0;
			var artist_track_word = '';
			var on_title_track = 0;
			var title_track_word = '';
			// mix the characters a first time, including the first letter of each solution
			mix_characters( data[0] );
		}
	}

    </script>

</body>